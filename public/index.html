<!DOCTYPE html>
<html>
<head>
  <title>DStats - Real-time Requests</title>
  <script src="https://code.highcharts.com/highcharts.js"></script>
  <style>
    body { margin: 0; padding: 20px; background: #1e1e1e; color: #fff; font-family: Arial, sans-serif; }
    .container { max-width: 1200px; margin: 0 auto; background: #2d2d2d; padding: 20px; border-radius: 8px; }
    h1 { text-align: center; margin-bottom: 20px; color: #00ff88; }
    #chart { height: 400px; margin: 20px 0; }
    #counter { text-align: center; font-size: 24px; color: #00ff88; margin-bottom: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>DStats - Real-time Requests</h1>
    <div id="counter">Total Requests: 0</div>
    <div id="chart"></div>
  </div>
  <script>
    let chart

    function initChart() {
      chart = Highcharts.chart('chart', {
        chart: { type: 'areaspline', animation: { duration: 1000 } },
        title: { text: 'Live Requests per Second' },
        xAxis: { type: 'datetime', labels: { format: '{value:%H:%M:%S}' } },
        yAxis: { title: { text: 'Requests' }, min: 0, allowDecimals: false },
        series: [{
          name: 'Requests',
          color: '#00ff88',
          fillColor: 'rgba(0, 255, 136, 0.3)',
          lineWidth: 2,
          data: []
        }],
        plotOptions: {
          areaspline: {
            marker: { enabled: false },
            lineWidth: 2,
            states: { hover: { lineWidth: 3 } }
          }
        },
        legend: { enabled: false }
      })
    }

    async function updateChart() {
      try {
        const response = await fetch('/api/stats', {
          headers: { 'Accept': 'application/json' }
        })
        if (!response.ok) return
        const data = await response.json()
        if (chart) {
          chart.series[0].setData(data.seriesData, true, true, true)
        }
        document.getElementById('counter').textContent = 'Total Requests: ' + data.totalRequests
      } catch (error) {}
    }

    document.addEventListener('DOMContentLoaded', () => {
      initChart()
      updateChart()
      setInterval(updateChart, 1000)
    })
  </script>
</body>
</html>
